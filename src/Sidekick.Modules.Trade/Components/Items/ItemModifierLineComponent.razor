@using Sidekick.Common.Game.Items

@if (ModifierLine.Modifiers.Any())
{
    var modifier = ModifierLine.Modifiers.FirstOrDefault();

    if (IsFirstOfBlock)
    {
        <ItemSeparator Rarity="Item.Header.Rarity"/>
    }

    <TextBase Class="relative px-2 font-caps text-center text-[##8888FF] leading-none py-[1px]">
        <ItemModifierText Category="modifier?.Category">@ModifierLine.Text</ItemModifierText>
        @if (!string.IsNullOrWhiteSpace(modifier?.Tier))
        {
            <span class="absolute top-0.5 left-[-6px] @GetTierClass(modifier.Tier)">@modifier.Tier</span>
        }
    </TextBase>
}

@code {

    [Parameter]
    public required Item Item { get; set; }

    [Parameter]
    public required ModifierLine ModifierLine { get; set; }

    private ModifierCategory Category => ModifierLine.Modifiers.FirstOrDefault()?.Category ?? ModifierCategory.Undefined;

    private bool IsFirstOfBlock
    {
        get
        {
            var index = Item.ModifierLines.IndexOf(ModifierLine);
            var previous = Item.ModifierLines.ElementAtOrDefault(index - 1);
            return previous == null || ModifierLine.BlockIndex != previous.BlockIndex;
        }
    }

    private string GetTierClass(string tier) => tier.StartsWith("P") ? "text-[#ec7676]" : "text-[#7aaff1]";

}
