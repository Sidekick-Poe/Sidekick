@using Sidekick.Apis.Poe.Trade.Bulk
@using Sidekick.Common.Game
@using Sidekick.Common.Game.Items
@using Sidekick.Modules.Trade.Exchange.Localization
@using Sidekick.Common.Ui.Tabs

@if (SupportsCurrencyExchange && Item.Header.Game == GameType.PathOfExile2)
{
    <TabItem Active="@(CurrentTab == "exchange")"
             Text="@Resources["CurrencyExchange"]"
             OnClick="@(() => CurrentTabChanged.InvokeAsync("exchange"))"/>
}

@inject IStringLocalizer<ExchangeResources> Resources
@inject IBulkTradeService BulkTradeService

@code {

    [CascadingParameter]
    public required Item Item { get; set; }

    [Parameter]
    public string? CurrentTab { get; set; }

    [Parameter]
    public EventCallback<string?> CurrentTabChanged { get; set; }

    private bool SupportsCurrencyExchange { get; set; }

    protected override async Task OnInitializedAsync()
    {
        SupportsCurrencyExchange = BulkTradeService.SupportsBulkTrade(Item);
        if (SupportsCurrencyExchange)
        {
             await CurrentTabChanged.InvokeAsync("exchange");
        }

        await base.OnInitializedAsync();
    }

}