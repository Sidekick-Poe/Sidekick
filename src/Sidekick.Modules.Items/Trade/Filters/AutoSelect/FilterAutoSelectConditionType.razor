@using Sidekick.Apis.Poe.Trade.Parser.Properties
@using Sidekick.Apis.Poe.Trade.Parser.Properties.Definitions
@using Sidekick.Apis.Poe.Trade.Trade.Filters.AutoSelect

<FormSelectInline Value="@Condition.Type.ToString()"
                  ValueChanged="Changed"
                  Options="Options"
                  Readonly="Readonly"/>

@inject IPropertyParser PropertyParser

@code {

    [Parameter]
    public required AutoSelectCondition Condition { get; set; }

    [Parameter]
    public bool Readonly { get; set; }

    [Parameter]
    public EventCallback OnChanged { get; set; }

    private List<SelectOption> Options { get; set; } = [];

    protected override void OnInitialized()
    {
        Update();
        base.OnInitialized();
    }

    public void Update()
    {
        Options.Clear();

        foreach (var value in Enum.GetValues<AutoSelectConditionType>())
        {
            var label = value switch
            {
                AutoSelectConditionType.ItemClass => PropertyParser.GetDefinition<ItemClassProperty>().Label,
                _ => value.ToString(),
            };

            Options.Add(new SelectOption()
            {
                Label =label,
                Value = value.ToString(),
            });
        }

        StateHasChanged();
    }

    private async Task Changed(string? value)
    {
        if (!Enum.TryParse<AutoSelectConditionType>(value, out var enumValue))
        {
            return;
        }

        Condition.Type = enumValue;
        await OnChanged.InvokeAsync();
    }
}
