@using Sidekick.Apis.Poe.Items
@using Sidekick.Apis.Poe.Trade.Trade.Filters.Types
@using Sidekick.Data.Languages
@using Sidekick.Data.Items.Models
@using Sidekick.Apis.PoeWiki

@if (OilNames.Count == 0)
{
    return;
}

<div class="flex flex-nowrap items-center mx-1">
    @foreach (var oilName in OilNames)
    {
        <Tooltip Text="@oilName">
            <img src="/images/blight/@(oilName.Replace(" ", "_")).png" class="size-8 min-w-8 min-h-8" alt="@oilName"/>
        </Tooltip>
    }
</div>

@inject IPoeWikiClient PoeWikiClient
@inject ICurrentGameLanguage CurrentGameLanguage

@code {

    [CascadingParameter]
    public required Item Item { get; set; }

    [Parameter]
    public required StatFilter Filter { get; set; }

    private List<string> OilNames { get; set; } = [];

    protected override async Task OnParametersSetAsync()
    {
        OilNames.Clear();

        if (Item.Game == GameType.PathOfExile2)
        {
            return;
        }

        if (Filter.Stat.MatchedPatterns.FirstOrDefault()?.Category == StatCategory.Enchant && CurrentGameLanguage.IsEnglish())
        {
            var oilMetadataIds = await PoeWikiClient.GetOilsMetadataIdsFromEnchantment(Filter.Stat);

            OilNames = oilMetadataIds.Where(x => PoeWikiClient.BlightOilNamesByMetadataIds.ContainsKey(x)).Select(x => PoeWikiClient.BlightOilNamesByMetadataIds[x]).ToList();
        }
    }

}
