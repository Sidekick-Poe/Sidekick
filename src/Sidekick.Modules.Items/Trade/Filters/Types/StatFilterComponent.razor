@using Sidekick.Apis.Poe.Items
@using Sidekick.Apis.Poe.Trade.Trade.Filters.Types
@using Sidekick.Modules.Items.Localization

<FilterWrapper Filter="Filter">
    <div class="grow">
        <FormCheckbox Value="Filter.Checked"
                      ValueChanged="CheckedChanged">
            <ItemStatText Class="text-left"
                          Category="Filter.Stat.ApiInformation.FirstOrDefault()?.Category">@Filter.Text</ItemStatText>
        </FormCheckbox>
    </div>

    <OilAnointment Filter="Filter"/>

    <div class="flex flex-col items-end justify-between gap-[2px] -mr-1">
        @if (Filter is
                 {
                     Checked: true,
                     SecondaryCategory: not StatCategory.Undefined
                 })
        {
            <Tooltip Text="@Resources["ForceCategoryHint"]" Placement="TooltipPlacement.Right">
                <ItemStatCategoryChip Category="Filter.PrimaryCategory"
                                      Checked="Filter.UsePrimaryCategory"
                                      ShowCheckbox="true"
                                      OnClick="() => Filter.UsePrimaryCategory = !Filter.UsePrimaryCategory"/>
            </Tooltip>
        }

        @if (Filter is
                 {
                     Checked: true,
                     Stat:
                     {
                         HasValues: true
                     }
                 })
        {
            <FilterRange Checked="Filter.Checked"
                         NormalizeEnabled="true"
                         NormalizeRoundToInteger="true"
                         Value="@Filter.Stat.AverageValue"
                         @bind-Min="@Filter.Min"
                         @bind-Max="@Filter.Max"/>
        }
    </div>
</FilterWrapper>

@inject IStringLocalizer<TradeResources> Resources

@code {

    [Parameter]
    public required StatFilter Filter { get; set; }

    private void CheckedChanged(bool value)
    {
        Filter.Checked = value;
    }

}
