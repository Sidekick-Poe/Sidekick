@inherits LayoutComponentBase
@layout MenuLayout

<MudDrawer @bind-Open="@Layout.MenuOpened"
           Anchor="Anchor.Left"
           Variant="@DrawerVariant.Responsive"
           Breakpoint="Breakpoint.Lg"
           ClipMode="DrawerClipMode.Docked">
    <MudDrawerHeader>
        <MudText Typo="Typo.h5">@Resources.Cheatsheets</MudText>
    </MudDrawerHeader>
    <MudNavMenu>
        <MudNavGroup Title="@Resources.Pages"
                     Expanded="true">
            @foreach (var wikiPage in Settings.Cheatsheets_WikiPages)
            {
                <MudNavLink Match="NavLinkMatch.All"
                            Href="@($"/cheatsheets/{wikiPage.Key.EncodeBase64Url()}")">
                    @wikiPage.Key
                </MudNavLink>
            }
        </MudNavGroup>
    </MudNavMenu>
</MudDrawer>

<MudMainContent>
    <MudContainer MaxWidth="MaxWidth.False" Class="pa-0" Style="overflow: hidden; height: calc(100vh - var(--mud-appbar-height));">
        @Body
    </MudContainer>
</MudMainContent>

@code {
    [Inject] private CheatsheetResources Resources { get; set; }
    [Inject] private NavigationManager NavigationManager { get; set; }
    [Inject] private ISettingsService SettingsService { get; set; }
    [Inject] private ISettings Settings { get; set; }

    [CascadingParameter] public MenuLayout Layout { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var routeMatch = new System.Text.RegularExpressions.Regex("cheatsheets\\/([^\\\\\\/]*)").Match(NavigationManager.Uri);
        if (routeMatch.Success)
        {
            await SettingsService.Save(nameof(ISettings.Cheatsheets_Selected), routeMatch.Groups[1].Value);
        }

        await base.OnInitializedAsync();
    }
}
